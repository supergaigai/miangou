/**
 * Lifecycle-B2B 1.0.0-20170426
 * Copyright © 2017 Lifecycle Co.,Ltd.
 * http://www.lifecycle.cn/
 */
angular.module("lifecycle.common",["lifecycle.common.component","lifecycle.common.service","lifecycle.common.util"]).config(["$translatePartialLoaderProvider",function(a){a.addPart("common")}]),angular.module("lifecycle.common").constant("$config",{app:{name:"Lifecycle B2B",version:"1.0.0",supportedBrowsers:{Chrome:"28",Firefox:"29",IE:"11"},supportedTemplates:["default"],template:"default",supportedThemes:["default","cameoBrown","orange","yellow","green","cyan","black","golden"],theme:"default",preferredLanguage:"zh_CN",fallbackLanguage:"zh_CN",update:{packages:{wine:{baseUrl:"http://192.168.100.18:10190/wine/upd/",lcz:["wine.app","wine.lib"]},"b2b-mobile":{baseUrl:"http://192.168.100.18:10190/b2b/m/upd/",lcz:["b2b-mobile.app","b2b-mobile.lib","b2b-mobile.tpl.default","b2b-mobile.tpl.mumuso","b2b-mobile.tpl.cotton","b2b-mobile.tpl.both"]}}},image:{s:{width:60,height:60},m:{width:220,height:220},l:{width:400,height:400},x:{width:800,height:800}}},portal:{address:"",restPath:"/servlets/binserv/Rest",b2bPath:"/servlets/binserv/B2B",reportPath:"/servlets/binserv/Phone",miscCmd:"com.agilecontrol.phone.B2BCmd",imagePath:"/pdt/l/",pdtImgPath:"/pdt",expireTime:{hasCachekey:"0",noCachekey:"0"},cachePoolSize:"500",name:"B2B"},b2b:{agreementAK:"selling_agreement_",footerTable:"ad_sql",useServerTranslate:!1},adSqlKey:{nav:"b2b:nav",footer:"b2b:footer",pdtSummary:"b2b:pdt:summary",pdtDesc:"b2b:pdt:desc"},pdt:{pagination:{pageSize:20},orderby:{items:[{type:"toggle",options:[{text:"pdt.orderby.pdt-orderno-asc",value:"pdt_orderno_asc",isActive:!0}]},{type:"toggle",options:[{text:"pdt.orderby.pdt-price-asc",value:"pdt_price_asc",isActive:!1},{text:"pdt.orderby.pdt-price-desc",value:"pdt_price_desc"}]}]},summary:[[{colname:"stylename"},{colname:"no"}],[{colname:"price",type:"currency",style:"font-size:18px;color:red"}]]},bookmark:{pagination:{pageSize:20},orderby:{items:[{type:"toggle",options:[{text:"pdt.orderby.pdt-orderno-asc",value:"pdt_orderno_asc",isActive:!1}]},{type:"toggle",options:[{text:"pdt.orderby.pdt-price-asc",value:"pdt_price_asc",isActive:!1},{text:"pdt.orderby.pdt-price-desc",value:"pdt_price_desc"}]}]}},act:{pagination:{pageSize:20},orderby:{items:[{type:"toggle",options:[{text:"pdt.orderby.act-orderno-asc",value:"act_orderno_asc",isActive:!1}]},{type:"toggle",options:[{text:"pdt.orderby.act-price-asc",value:"act_price_asc",isActive:!0},{text:"pdt.orderby.act-price-desc",value:"act_price_desc"}]}]}},order:{pagination:{pageSize:20}},imageServer:{qiniu:{address:"需配置"},ali:{address:"需配置"}},news:{pagination:{pageSize:10}}}).config(["$config",function($config){var datajson=null,dst={};try{datajson=eval(config)}catch(a){return}angular.merge($config,$config,datajson)}]),angular.module("lifecycle.common.component",[]),angular.module("lifecycle.common.service",[]),angular.module("lifecycle.common.util",[]),angular.module("lifecycle.common.component").filter("imgPath",["$config",function(a){return function(b,c){if(!b)return b;var d=b.toString().trim(),e="."==d.substring(d.length-1);return e&&(d=d.substring(0,d.length-1)),0==d.indexOf("img/")?d=a.app.template+"/"+d:d.indexOf("/Attach")!=-1?d=c?a.portal.address+d+"?s="+c:a.portal.address+d:0==d.indexOf(a.imageServer.qiniu.address)?c&&(d=d+"?imageMogr2/thumbnail/"+a.app.image[c].width+"x"+a.app.image[c].height):0==d.indexOf(a.imageServer.ali.address)?c&&(d=d+"?x-oss-process=image/resize,m_lfit,h_"+a.app.image[c].width+",w_"+a.app.image[c].height):d.indexOf("/")!=-1?d=a.portal.address+d:d.indexOf("/")==-1&&(c||(c="m"),d=a.portal.address+a.portal.pdtImgPath+"/"+c+"/"+d),d}}]),angular.module("lifecycle.common.component").filter("intervalPrice",["$config",function(a){return function(a){return a.qty1&&a.qty2?a.qty1+"~"+a.qty2+"件":a.qty1&&!a.qty2?"≥"+a.qty1+"件":!a.qty1&&a.qty2?a.qty1+"≤件":a.qty1+"~"+a.qty2+"件"}}]),angular.module("lifecycle.common.component").factory("$msg",["$q","$window",function(a,b){function c(c){var d=a.defer();return b.alert(c),d.resolve(),d.promise}function d(c,d){var e=a.defer();return b.alert(c),e.resolve(),e.promise}function e(c,d,e){var f=a.defer();return b.confirm(c)?f.resolve(!0):f.reject(!1),f.promise}function f(c,d,e,f,g){var h=a.defer(),i=b.prompt(c,d);return null===i?h.reject():h.resolve(i),h.promise}return{toast:c,alert:d,confirm:e,prompt:f}}]),angular.module("lifecycle.common.service").factory("$attach",["$config","$http","$miscCmd",function(a,b,c){function d(a,b,c){this.table=a,this.column=b,this.objectid=c,this.fileId=g+h++}var e=a.portal.address+"/control/upload",f="com.agilecontrol.phone.cmd.ManageAttach",g="file",h=1;return d.prototype.list=function(){return c.execute(f,{action:"list",table:this.table,column:this.column,objectid:this.objectid}).then(function(a){return a.files})},d.prototype.remove=function(a){return c.execute(f,{action:"delete",table:this.table,column:this.column,objectid:this.objectid,files:a}).then(function(a){return a.files||[]})},d.prototype.upload=function(a){var c=new FormData;return c.append("file",a),c.append("table",this.table),c.append("column",this.column),c.append("objectid",this.objectid),c.append("rest","Y"),c.append("upload",!0),b.post(e,c,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).then(function(a){return a.url})},d.prototype.update=function(a,c){var d=new FormData;return d.append("file",c),d.append("table",this.table),d.append("column",this.column),d.append("objectid",this.objectid),d.append("file",a),d.append("rest","Y"),d.append("upload",!0),b.post(e,d,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).then(function(a){return a.url})},d.prototype.getFileId=function(){return this.fileId},function(a,b,c){return new d(a,b,c)}}]),angular.module("lifecycle.common.service").factory("$auth",["$miscCmd","$q","$translate",function(a,b,c){function d(d,e){var f=b.defer();return d&&""!==d?e&&""!==e?a.execute("b2b.login",{username:d,password:e}):(f.reject({source:"Client",code:-3,message:c.instant("auth.password-required")}),f.promise):(f.reject({source:"Client",code:-2,message:c.instant("auth.username-required")}),f.promise)}function e(){return a.execute("b2b.logout")}function f(d,e,f){var g=b.defer();return d&&""!==d?e&&""!==e?f&&""!==f?d===e?(g.reject({source:"Client",code:-5,message:c.instant("auth.pwd-not-changed")}),g.promise):e!==f?(g.reject({source:"Client",code:-6,message:c.instant("auth.cfm-pwd-failed")}),g.promise):a.execute("b2b.user.modifypassword",{oldpassword:d,newpassword:e}):(g.reject({source:"Client",code:-4,message:c.instant("auth.cfm-pwd-required")}),g.promise):(g.reject({source:"Client",code:-3,message:c.instant("auth.new-pwd-required")}),g.promise):(g.reject({source:"Client",code:-2,message:c.instant("auth.orig-pwd-required")}),g.promise)}return{login:d,logout:e,changePassword:f}}]),angular.module("lifecycle.common.service").factory("$miscCmd",["$rootScope","$config","$portalClient","$q","$log","$translate",function(a,b,c,d,e,f){function g(b,e){var f=d.defer();return e||(e={}),e.cmd=b,c.sendRequest(h,i,e).then(function(b){if(0===b.code){var c=b.result||b;f.resolve(c)}else{var d={source:"MiscCmd",code:b.code,message:b.message};f.reject(d),a.$emit("$serverFailure",d),console.log("error: "+JSON.stringify(d))}},function(a){f.reject(a)}),f.promise}var h=b.portal.address+b.portal.b2bPath,i=b.portal.miscCmd;return{execute:g}}]),angular.module("lifecycle.common.service").factory("$portalClient",["$rootScope","$http","$q","$log","$translate",function(a,b,c,d,e){function f(d,f,h){var i=c.defer(),j=[{id:1,command:f,params:h}],k="transactions="+encodeURIComponent(JSON.stringify(j));return b.post(d,k,{headers:{"Content-Type":"application/x-www-form-urlencoded"},withCredentials:!0}).then(function(b){var c=b.headers("sip_status");if("9999"===c){var d=b.data[0]||null;i.resolve(d)}else{var f={source:"Portal",code:c,message:e.instant(g[c])};i.reject(f),a.$emit("$serverFailure",f),console.log("error: "+JSON.stringify(f))}},function(b){var c={source:"HTTP",code:b.status,message:b.statusText};i.reject(c),a.$emit("$serverFailure",c),console.log("error: "+JSON.stringify(c))}),i.promise}var g={"0000":"sipStatus.error",9999:"sipStatus.success",1001:"sipStatus.signatureInvalid",1002:"sipStatus.reqTimeout",1003:"sipStatus.binduserFaild",1004:"sipStatus.needBinduser",1005:"sipStatus.needAppKey",1006:"sipStatus.needApiName",1007:"sipStatus.needSign",1008:"sipStatus.needTimeStamp",1009:"sipStatus.authFaild",1010:"sipStatus.noRightCallService",1011:"sipStatus.service",1012:"sipStatus.sessionid",1013:"sipStatus.username"};return{sendRequest:f}}]),angular.module("lifecycle.common.service").factory("$restCmd",["$config","$rootScope","$portalClient","$q","$log","$translate",function(a,b,c,d,e,f){function g(a,f){var g=d.defer();return c.sendRequest(q,a,f).then(function(a){if(0===a.code)g.resolve(a);else{var c={source:"RestCmd",code:a.code,message:a.message};g.reject(c),b.$emit("$serverFailure",c),e.error("error: "+JSON.stringify(c))}},function(a){g.reject(a)}),g.promise}function h(a){return g("Query",a)}function i(a){return g("ObjectDelete",a)}function j(a){return g("GetObject",a)}function k(a){return g("ObjectSubmit",a)}function l(a){return g("ObjectUnsubmit",a)}function m(a){return g("ExecuteWebAction",a)}function n(a){return g("ObjectCreate",a)}function o(a){return g("ObjectModify",a)}function p(a){return g("ExecuteAudit",a)}var q=a.portal.address+a.portal.restPath;return{execute:g,query:h,objectDelete:i,getObject:j,objectSubmit:k,objectUnsubmit:l,executeWebAction:m,objectCreate:n,objectModify:o,executeAudit:p}}]),angular.module("lifecycle.common.service").factory("$runSQL",["$miscCmd","$q","$rootScope",function(a,b,c){function d(b,c,d){return a.execute(h,{type:"QUERY",name:b,var:c,row_is_obj:void 0===d||d})}function e(a,e){var f=b.defer();return d(a,e,!1).then(function(a){if(a&&a.length>0)f.resolve(a[0]);else{var b={source:"runSQL",code:-1,message:"No result"};f.reject(b),c.$emit("$serverFailure",b)}},function(a){f.reject(a)}),f.promise}function f(b){return a.execute(h,{type:"JSON",name:b})}function g(b){return a.execute(h,{type:"TEXT",name:b})}var h="com.agilecontrol.phone.cmd.RunSQL";return{query:d,singleValue:e,getJSON:f,getText:g}}]),angular.module("lifecycle.common.service").factory("$serverConfig",["$miscCmd","$q","$rootScope",function(a,b,c){function d(b){var c={name:b};return a.execute(e,c)}var e="com.agilecontrol.phone.cmd.ServerConfig";return{getServerConfig:d}}]),angular.module("lifecycle.common.service").factory("$sys",["$rootScope","$translate","$cookies","$config","$miscCmd",function(a,b,c,d,e){function f(){return e.execute("b2b.user.langlist")}function g(){return a.currentLanguage||(a.currentLanguage=c.get("CURRENT_LANGUAGE")||d.app.preferredLanguage||d.app.fallbackLanguage),a.currentLanguage}function h(d){a.currentLanguage=d,c.put("CURRENT_LANGUAGE",d),sessionStorage.setItem("CURRENT_LANGUAGE",d),b.use(b.negotiateLocale(d))}function i(){return a.currentTheme||(a.currentTheme=localStorage.getItem("CURRENT_THEME")?localStorage.getItem("CURRENT_THEME"):d.app.theme),a.currentTheme}function j(b){a.currentTheme=b,localStorage.setItem("CURRENT_THEME",b)}return{getSupportedLanguages:f,getCurrentLanguage:g,changeLanguage:h,getCurrentTheme:i,changeTheme:j}}]),angular.module("lifecycle.common.service").factory("updater",["$config","$q","$http","$log",function(a,b,c,d){var e=function(a){return b(function(c,e){b.all({remotes:f(a),clients:g(a)}).then(function(a){var b=a.remotes,e=a.clients,f=[];angular.forEach(b,function(a,b){if(void 0==e[b]||e[b]<a){var c=b+".lcz";f.push(c)}}),d.debug("updater.checkUpdate() resolved: "+JSON.stringify(f)),c(f)},function(a){d.error("updater.checkUpdate() rejected: "+JSON.stringify(a)),e(a)})})},f=function(e){for(var f=b.defer(),g={},h=a.app.update.packages[e],i=0;i<h.lcz.length;i++){var j=h.baseUrl+h.lcz[i]+".json";g[h.lcz[i]]=c.get(j)}return b.all(g).then(function(a){var b={};for(var c in a)b[c]=a[c].data.version;f.resolve(b)},function(a){d.error("updater.getRemoteVers() rejected: "+JSON.stringify(a)),f.reject(a)}),f.promise},g=function(e){for(var f=b.defer(),g={},h=a.app.update.packages[e],i=0;i<h.lcz.length;i++){var j="upd/"+h.lcz[i]+".json";g[h.lcz[i]]=c.get(j)}return b.all(g).then(function(a){var b={};for(var c in a)b[c]=a[c].data.version;f.resolve(b)},function(a){d.error("updater.getLastVers() rejected: "+JSON.stringify(a)),f.reject(a)}),f.promise},h=function(b,c){var e=a.app.update.packages[c];if(b.length>0){for(var f="wxs://?action=update&url=",g=0;g<b.length;g++)f+=e.baseUrl+b[g],g<b.length-1&&(f+=",");d.info("Send update request: "+f),location.href=f}};return{checkUpdate:e,update:h,getLastVers:g}}]),angular.module("lifecycle.common.service").factory("$wxshell",["$q",function(a){return openNavi=function(){var b=a.defer();return wxshell.openNavi({success:function(a){b.resolve(a)},fail:function(a){b.reject(a)}}),b.promise},yzReg=function(b){var c=a.defer();return wxshell.yzOpen({success:function(a){c.resolve(a)},fail:function(a){c.reject(a)},appKey:b.appKey,appSecret:b.appSecret}),c.promise},yzOpen=function(b){var c=a.defer();return wxshell.yzOpen({success:function(a){c.resolve(a)},fail:function(a){c.reject(a)},shopUrl:b.shopUrl,user:b.user}),c.promise},getLocation=function(){var b=a.defer();return wxshell.getLocation({success:function(a){b.resolve(a)},fail:function(a){b.reject(a)}}),b.promise},scanQRCode=function(){var b=a.defer();return wxshell.scanQRCode({success:function(a){b.resolve(a)},fail:function(a){b.reject(a)}}),b.promise},xgPush=function(b){var c=a.defer();return wxshell.xgPush({success:function(a){c.resolve(a)},fail:function(a){c.reject(a)},appId:b.appId,appKey:b.appKey}),c.promise},socialShare=function(b){var c=a.defer();return wxshell.socialShare({success:function(a){c.resolve(a)},fail:function(a){c.reject(a)},url:b.url,text:b.text}),c.promise},getDeviceInfo=function(){var b=a.defer();return wxshell.getDeviceInfo({success:function(a){b.resolve(a)},fail:function(a){b.reject(a)}}),b.promise},syncCalendar=function(b){var c=a.defer();return wxshell.syncCalendar({success:function(a){c.resolve(a)},fail:function(a){c.reject(a)},events:b.events}),c.promise},syncContact=function(b){var c=a.defer();return wxshell.syncContact({success:function(a){c.resolve(a)},fail:function(a){c.reject(a)},events:b.events}),c.promise},setStatusBar=function(b){var c=a.defer();return wxshell.setStatusBar({success:function(a){c.resolve(a)},fail:function(a){c.reject(a)},style:b.style,color:b.color}),c.promise},getHeaderInfo=function(){var b=a.defer();return wxshell.getHeaderInfo({success:function(a){b.resolve(a)},fail:function(a){b.reject(a)}}),b.promise},echo=function(b){var c=a.defer();return wxshell.echo(function(a){c.resolve(a)},function(a){c.reject(a)},b),c.promise},echo2=function(b,c){var d=a.defer();return wxshell.echo2(function(a){d.resolve(a)},function(a){d.reject(a)},b,c),d.promise},getNetworkType=function(){var b=a.defer();return wxshell.getNetworkType({success:function(a){b.resolve(a)},fail:function(a){b.reject(a)}}),b.promise},translateVoice=function(b){var c=a.defer();return wxshell.translateVoice({success:function(a){c.resolve(a)},fail:function(a){c.reject(a)},localId:b.localId}),c.promise},startRecord=function(){var b=a.defer();return wxshell.startRecord({success:function(a){b.resolve(a)},fail:function(a){b.reject(a)}}),b.promise},stopRecord=function(){var b=a.defer();return wxshell.stopRecord({success:function(a){b.resolve(a)},fail:function(a){b.reject(a)}}),b.promise},playVoice=function(b){var c=a.defer();return wxshell.playVoice({success:function(a){c.resolve(a)},fail:function(a){c.reject(a)},localId:b.localId}),c.promise},stopVoice=function(){var b=a.defer();return wxshell.stopVoice({success:function(a){b.resolve(a)},fail:function(a){b.reject(a)}}),b.promise},openLocation=function(b){var c=a.defer();return wxshell.playVoice({success:function(a){c.resolve(a)},fail:function(a){c.reject(a)},latitude:b.latitude,longitude:b.longitude,name:b.name,address:b.address,scale:b.scale,infoUrl:b.infoUrl}),c.promise},openExplorer=function(){var b=a.defer();return wxshell.openExplorer({success:function(a){b.resolve(a)},fail:function(a){b.reject(a)}}),b.promise},chooseImage=function(){var b=a.defer();return wxshell.chooseImage({success:function(a){b.resolve(a)},fail:function(a){b.reject(a)}}),b.promise},updatePackage=function(b){var c=a.defer();return wxshell.updatePackage({success:function(a){c.resolve(a)},fail:function(a){c.reject(a)},url:b.url}),c.promise},nativeAlert=function(b){var c=a.defer();return wxshell.nativeAlert(b),c.promise},portalChoosePhoto=function(b){var c=a.defer();return"android"==wxshell_.os&&(b=JSON.stringify(b)),wxshell.portalChoosePhoto(b,function(a){c.resolve(a)},function(a){c.reject(a)}),c.promise},portalPhotoManage=function(b){var c=a.defer();return"android"==wxshell_.os&&(b=JSON.stringify(b)),wxshell.portalChoosePhoto(b,function(a){c.resolve(a)},function(a){c.reject(a)}),c.promise},{yzReg:yzReg,yzOpen:yzOpen,getLocation:getLocation,scanQRCode:scanQRCode,xgPush:xgPush,socialShare:socialShare,getDeviceInfo:getDeviceInfo,syncCalendar:syncCalendar,syncContact:syncContact,setStatusBar:setStatusBar,getHeaderInfo:getHeaderInfo,echo:echo,echo2:echo2,getNetworkType:getNetworkType,translateVoice:translateVoice,startRecord:startRecord,stopRecord:stopRecord,playVoice:playVoice,stopVoice:stopVoice,openLocation:openLocation,openExplorer:openExplorer,chooseImage:chooseImage,updatePackage:updatePackage,nativeAlert:nativeAlert,portalChoosePhoto:portalChoosePhoto,portalPhotoManage:portalPhotoManage}}]),angular.module("lifecycle.common.util").factory("$keygen",[function(){var a=0;return{nextInt:function(){return a++}}}]),angular.module("lifecycle.common.util").factory("$localStorage",["$window",function(a){return{set:function(b,c){a.localStorage[b]=c},get:function(b){return a.localStorage[b]},setObject:function(b,c){a.localStorage[b]=JSON.stringify(c)},getObject:function(b){return a.localStorage[b]&&JSON.parse(a.localStorage[b])},remove:function(b){a.localStorage.removeItem(b)},clear:function(){a.localStorage.clear()},lenght:a.localStorage.length}}]),angular.module("lifecycle.common.util").factory("$numberUtils",[function(){function a(a,b){var c,d,e;try{d=a.toString().split(".")[1].length}catch(a){d=0}try{e=b.toString().split(".")[1].length}catch(a){e=0}return c=Math.pow(10,Math.max(d,e)),(a*c+b*c)/c}function b(a,b){var c,d,e,f;try{d=a.toString().split(".")[1].length}catch(a){d=0}try{e=b.toString().split(".")[1].length}catch(a){e=0}return c=Math.pow(10,Math.max(d,e)),f=d>=e?d:e,((a*c-b*c)/c).toFixed(f)}return{numAdd:a,numSub:b}}]),angular.module("lifecycle.common.util").factory("$valiUtils",[function(){function a(a){return"undefined"==typeof a||null==a||""==a}function b(a){for(var b in a)return!1;return!0}return{isNull:a,isEmpty:b}}]);